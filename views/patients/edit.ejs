<head>
  <title>Edit Patient</title>
</head>

<body>
  <%- include('../partials/_navbar.ejs') %>

  <h1>Edit Patient Details</h1>

  <form action="/patients/<%= patient._id %>?_method=PUT" method="POST">
    <!-- Name -->
    <label for="name">Name:</label>
    <input type="text" id="name" name="name" value="<%= patient.name %>" required>

    <!-- Age -->
    <label for="age">Age:</label>
    <input type="number" id="age" name="age" value="<%= patient.age %>" required>

    <!-- Gender -->
    <label for="gender">Gender:</label>
    <select id="gender" name="gender" required>
      <option value="Male" <%= patient.gender === "Male" ? "selected" : "" %>>Male</option>
      <option value="Female" <%= patient.gender === "Female" ? "selected" : "" %>>Female</option>
      <option value="Other" <%= patient.gender === "Other" ? "selected" : "" %>>Other</option>
    </select>

    <!-- CPR ID -->
    <label for="cprId">CPR ID:</label>
    <input type="text" id="cprId" name="cprId" value="<%= patient.cprId %>" required>

    <!-- Department -->
    <label for="department">Department:</label>
    <select id="department" name="department" required onchange="updateDescription()">
      <option value="" disabled>Select a Department</option>
      <% departments.forEach(department => { %>
      <option value="<%= department._id %>" data-description="<%= department.description %>" <%= patient.department._id.equals(department._id) ? "selected" : "" %>>
        <%= department.name %>
      </option>
      <% }); %>
    </select>
    <p id="departmentDescription" style="margin-top: 10px; font-style: italic;">
      Select a department to see its description.
    </p>

    <!-- Urgency Level -->
    <label for="urgencyLevel">Urgency Level:</label>
    <select id="urgencyLevel" name="urgencyLevel" required>
      <option value="" disabled>Select Urgency Level</option>
      <% urgencies.forEach(urgency => { %>
      <option value="<%= urgency._id %>" <%= patient.urgencyLevel._id.equals(urgency._id) ? "selected" : "" %>>
        <%= urgency.level %>
      </option>
      <% }); %>
    </select>

    <!-- Submit -->
    <button type="submit">Update Patient</button>
  </form>

  <script>
    // Update Department Description Dynamically
    function updateDescription() {
      const departmentSelect = document.getElementById('department');
      const selectedOption = departmentSelect.options[departmentSelect.selectedIndex];
      const description = selectedOption.getAttribute('data-description') || 'No description available';
      document.getElementById('departmentDescription').innerText = description;
    }

    // Pre-populate Department Description on Load
    document.addEventListener('DOMContentLoaded', () => {
      updateDescription();
    });

    // Add onchange event listener
    document.getElementById('department').addEventListener('change', updateDescription);
  </script>
</body>

</html>